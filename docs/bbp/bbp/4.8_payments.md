4.8 Payments & Settlement
Template Ref: _txn_03 (Medium/Complex Transaction)
4.8.1 Business Purpose
The Payments & Settlement module manages how approved supplier invoices are converted into actual payments, including:
Standard invoice payments


Part-payments and adjustments


Early payment discounts


Retentions and milestone payments


Settlements against debit notes or credit notes


Goals:
Ensure only approved, matched invoices (from 4.6) are paid.


Optimize cash flow and working capital via:


Payment scheduling


Discount programs


Prioritization rules.


Maintain a clear audit trail:


What invoice was paid?


When?


From which bank account?


Support different payment modes:


Bank transfer (NEFT/RTGS/ACH/SWIFT)


Cheque


Manual settlements (offline).


Hybrid behavior (config-driven):
Payments can be processed:


Per invoice (single-payment mode)


Via Payment Runs/Batches (group payments by date/supplier/bank).


Settlement model can:


Auto-apply credit notes and debit notes.


Support partial payments and multi-invoice settlement for a single payment.



4.8.2 Data Model
A) Payment Batch Header (supplier_payment_batch)
Represents one logical “payment run” (e.g., weekly payment cycle).
Field
Type
Required
Description
id
UUID
Yes
Primary key
company_id
FK
Yes
Company scope
batch_number
String(30)
Yes
Payment batch ID
batch_status
Enum
Yes
DRAFT, READY_FOR_REVIEW, APPROVAL_PENDING, APPROVED, EXECUTED, PARTIALLY_EXECUTED, CANCELLED
batch_date
Date
Yes
Logical batch/run date
payment_date
Date
No
Intended payment date
bank_account_id
FK (Bank Account)
Yes
Bank account used for this run
total_batch_amount
Decimal
Yes
Sum of planned payments in batch
currency_code
String(10)
Yes
Currency (usually company base)
created_by_user_id
FK (User)
Yes
Creator
reviewed_by_user_id
FK (User)
No
Optional reviewer before approval
approved_by_user_id
FK (User)
No
Approver for payment run
approved_at
DateTime
No
Approval timestamp
executed_by_user_id
FK (User)
No
Who triggered actual payment file/API
executed_at
DateTime
No
Execution timestamp
remarks_internal
Text
No
Internal notes for AP/Finance
created_at
DateTime
Auto


updated_at
DateTime
Auto




B) Supplier Payment (supplier_payment)
Represents one supplier-level payment instruction, possibly covering multiple invoices.
Field
Type
Required
Description
id
UUID
Yes
Primary key
supplier_payment_batch_id
FK (Payment Batch)
No
Optional; may also support ad-hoc payment (no batch)
company_id
FK
Yes
Company scope
supplier_id
FK (Supplier)
Yes
Supplier being paid
payment_reference_number
String(50)
Yes
Internal payment ref (can store bank UTR later)
payment_status
Enum
Yes
PLANNED, PENDING_EXECUTION, EXECUTED, FAILED, CANCELLED
payment_mode
Enum
Yes
BANK_TRANSFER, CHEQUE, MANUAL_SETTLEMENT, OTHER
bank_account_id
FK (Bank Account)
Yes
From which account money goes out
payment_currency_code
String(10)
Yes
Currency used
payment_amount
Decimal
Yes
Total amount paid to supplier
early_payment_discount_taken
Decimal
Yes
Total discount benefit taken (if any)
FX_rate_applied
Decimal
No
For foreign currency payments
payment_execution_ref
String(100)
No
UTR/transaction ID from bank
payment_value_date
Date
No
Actual settlement date at bank
remarks_internal
Text
No
Internal notes on payment
created_by_user_id
FK (User)
Yes
Creator
executed_by_user_id
FK (User)
No
Execution user
created_at
DateTime
Auto


updated_at
DateTime
Auto




C) Payment–Invoice Link (supplier_payment_invoice_link)
Connects payments to invoices and credit/debit notes.
Field
Type
Required
Description
id
UUID
Yes
Primary key
supplier_payment_id
FK (Supplier Payment)
Yes
Payment header
supplier_invoice_id
FK (Supplier Invoice)
Yes
Invoice settled (4.6)
gross_invoice_amount
Decimal
Yes
Original invoice value
credit_notes_adjusted_amount
Decimal
Yes
Total credit applied against this invoice
discount_taken_amount
Decimal
Yes
Early payment or other discount
net_payable_amount
Decimal
Yes
Net payable after above adjustments
amount_paid
Decimal
Yes
Actual paid amount (can be partial)
remaining_balance_after_payment
Decimal
Yes
Outstanding after this payment
settlement_type
Enum
Yes
FULL, PARTIAL, ADVANCE, FINAL

Note: Credit/debit notes may be modeled as special supplier_invoice entries or separate financial documents; this link handles netting logic conceptually.

D) Config / Control (Conceptual)
auto_select_invoices_due_within_days (e.g. 7 days)


payment_run_requires_approval (Yes/No; possibly threshold-based)


min_discount_percent_to_take_early_payment (e.g. >1% only)


max_invoices_per_payment (for UI constraints)


block_payment_if_invoice_status != APPROVED (true/false)


partial_payment_allowed (Yes/No; and when)



4.8.3 UI / UX Requirements
Screen Name(s):
Payment Run / Batch


Supplier Payments


Path: Finance / AP → Payments & Settlement

A) Payment Batch List
Columns:
Batch Number


Batch Date


Payment Date (planned/executed)


Bank Account


Total Amount


Status


Created By / Approved By / Executed By


Filters:
Date range


Status


Bank account


Created By / Approved By


Actions:
Create New Batch


View/Edit Batch


Submit for Approval


Approve Batch


Execute Batch (export bank file / trigger API)


Cancel Batch (if not executed)



B) Payment Batch Detail
Sections:
Header


Batch No, Date


Bank Account


Payment Date


Status


Remarks


Invoice Selection Panel


Filter invoices by:


Supplier


Due date range


Status = APPROVED


With/without discount eligibility


Multi-select invoices.


Selected Payments Grid


Supplier


Invoice Number


Invoice Date


Invoice Amount


Due Date


Suggested Payment Amount


Discount available? (Yes/No, discount amount)


Discount taken (checkbox or amount)


Net Payable


Included in Batch? (flag)


Totals section:
Sum of all net payable by supplier


Sum of batch total



C) Supplier Payment View
For each supplier_payment:
Supplier details (name, ID, bank info).


Payment amount and mode.


Linked invoices:


Invoice No, Amount, Paid Amount, Remaining Balance.


Actions:
Mark as Executed (if not using automatic bank integration).


Edit remarks.


View payment advice.



D) Payment Advice / Supplier Communication
Generate and store:
Payment Advice PDF / Email with:


Paid invoices list


Amounts


Any deductions (discounts, returns, debit notes)


Payment reference (UTR, cheque no, etc.)



4.8.4 Validation Rules
Header-level (Batch):
batch_number unique per company.


bank_account_id required.


payment_date cannot be in the past (or allowed with warning, per config).


Batch cannot move to APPROVAL_PENDING or APPROVED:


If no supplier_payment entries exist.


If any linked invoices are no longer in APPROVED status.


Supplier Payment-level:
payment_amount > 0.


payment_currency_code consistent with invoice or properly converted (FX handled upstream or by Finance).


For each linked invoice:


amount_paid ≤ net_payable_amount.


If partial_payment_allowed = false:


amount_paid must equal net_payable_amount (for full settlement).


Posting/Execution:
Cannot EXECUTE payment:


If batch/individual payment not APPROVED (where approval_required = true).


Cannot mark payment as EXECUTED twice.



4.8.5 Workflow
Batch-level:
DRAFT
 → Review → READY_FOR_REVIEW (optional intermediate)
 → Submit for Approval → APPROVAL_PENDING
 → Approve → APPROVED
 → Execute (bank file/API or manual) → EXECUTED


Alternative:
DRAFT → CANCELLED


APPROVAL_PENDING → REJECTED (and optionally back to DRAFT)


Supplier Payment-level:
PLANNED → PENDING_EXECUTION (once batch is approved)


PENDING_EXECUTION → EXECUTED (on confirm/payment file success)


PENDING_EXECUTION → FAILED (if bank rejects; can be retried or cancelled)


Integration with 4.6 Supplier Invoice:
Once payment is executed:


Update invoice’s paid amount and outstanding.


If fully paid:


Invoice status may move to PAID.


Retention and milestone scenarios:


Only portion of invoice may be included in payment.


Remaining becomes future liability.



4.8.6 Module Metadata & Build Steps
Module Metadata
module_type: transaction
complexity: medium_to_complex

template_ref: _txn_03

extension_allowed: true

depends_on:
  - Company
  - Suppliers
  - Supplier Invoice Matching (4.6)
  - Bank Accounts / Treasury
  - Users / Roles
  - Payment Configuration (tolerances, approval rules)

used_by:
  - Vendor Performance (4.9) - for payment behavior metrics
  - Cash Flow & Treasury Planning
  - Financial Ledger / AP


Build Steps (for AI / Implementation Engine)
You are building a Medium-to-Complex Transaction module for a Retail ERP.

Module: Payments & Settlement
Template: _txn_03

Requirements:

1) Backend (Django + DRF):

   Models:
   - supplier_payment_batch
   - supplier_payment
   - supplier_payment_invoice_link

   Serializers:
   - Batch with nested supplier_payment and rollup amounts.
   - Payment with nested invoice links.

   Viewsets & Endpoints:
   - CRUD for payment batches (up to APPROVAL_PENDING).
   - Actions:
     - submit_batch_for_approval
     - approve_batch
     - reject_batch
     - execute_batch
   - For individual payments:
     - create_ad_hoc_payment (optional)
     - mark_payment_executed
     - mark_payment_failed

   Integration:
   - Query `supplier_invoice` records with status `APPROVED` and not fully paid.
   - Update invoices’ paid/outstanding amounts.
   - Provide hooks to generate:
     - Bank files (e.g., CSV, XML, etc.)
     - Payment advice export.

2) Frontend (React + Vite + Tailwind):

   Screens:
   - Payment Batch List
   - Payment Batch Detail:
     - Header + invoice selection + payment summary.
   - Payment Detail:
     - View supplier payment with linked invoices.

   Behavior:
   - Respect status-based edit locks.
   - Clearly highlight discount-taking options and net payable amounts.

3) Security & Roles:

   - Roles:
     - Payment Batch Creator
     - Payment Approver
     - Payment Executor
     - Payment Viewer

Ensure all validation and workflows conform to the spec above.

